import subprocess
import re

proc = subprocess.Popen(['.\modern2.exe'], stdin=subprocess.PIPE, stdout=subprocess.PIPE)

input_data = b'%p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p%p%p%p\n'
proc.stdin.write(input_data)
proc.stdin.flush()

stdout_data = proc.stdout.read().decode()

pattern = r'\b[0-9A-Fa-f]+\b'

matches = re.findall(pattern, stdout_data)

if matches:
    value = matches[-1]
    print(f"De gevonden hexadecimale waarde is: \n{value}")

print("\nDeze waarde wordt nu geconverteerd naar ASCII")
hex_string = value

# Swap the endianness of each 8 byte (16 hex char) segment
swapped_hex_string = ''.join([hex_string[i:i+16] for i in range(0, len(hex_string), 16)][::-1])

# Split the string into 2-char segments (1 byte), join with space
hex_with_spaces = ' '.join([swapped_hex_string[i:i+2] for i in range(0, len(swapped_hex_string), 2)])

# Convert from hex to ASCII and reverse it
ascii_value = ''.join([chr(int(b, 16)) for b in hex_with_spaces.split()])[::-1]

print(f"\nDe geconverteerde waarde is: \n{ascii_value}")

